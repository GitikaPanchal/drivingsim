<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cruise Control Simulator</title>
    <link rel="icon" href="steering.png" type="image/png" />
    <style>
      body {
        margin: 0;
        display: flex;
        font-family: Arial, sans-serif;
      }
      #game {
        flex: 2;
        height: 100vh;
        background: linear-gradient(#555, #222);
        position: relative;
        overflow: hidden;
      }
      #dashboard {
        flex: 1;
        background: #f4f4f4;
        padding: 20px;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      #road {
        position: absolute;
        width: 100%;
        height: 100%;
        background: #333;
        overflow: hidden;
      }
      .lane-set {
        position: absolute;
        width: 100%;
        height: 100%;
        will-change: transform;
      }
      /* Modified lane-line style to make it look like actual road markers */
      .lane-line {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 10px;
        height: 30px; /* Shorter lines */
        background: white;
        border-radius: 2px; /* Slightly rounded edges */
      }
      #car {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%) rotate(180deg);
        width: 60px;
        height: 120px;
        background: url("car.png") no-repeat center center;
        background-size: cover;
      }
      #controls button {
        margin-top: 10px;
        padding: 10px;
        width: 100%;
      }
      .mechanical-diagram {
        margin-top: 20px;
        padding: 10px;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 10px;
      }
      .mechanical-diagram svg {
        width: 100%;
        height: 200px;
      }
      .mechanical-label {
        font-size: 12px;
        fill: #000;
      }
    </style>
  </head>
  <body>
    <div id="game">
      <div id="road"></div>
      <div id="car"></div>
    </div>
    <div id="dashboard">
      <div>
        <h2>Dashboard</h2>
        <p>Speed: <span id="speed">0</span> km/h</p>
        <p>Cruise Control: <span id="cruiseStatus">OFF</span></p>
        <div id="controls">
          <button onclick="accelerate()">Accelerate</button>
          <button onclick="decelerate()">Decelerate</button>
          <button onclick="toggleCruise()">Toggle Cruise Control</button>
        </div>
        <hr />
        <h3>Mechanics</h3>
        <p id="mechanicsLog">Waiting for action...</p>
      </div>
      <div class="mechanical-diagram">
        <h4>Internal Mechanics View</h4>
        <svg viewBox="0 0 200 200">
          <rect x="10" y="40" width="40" height="20" fill="#ccc" />
          <text x="30" y="35" class="mechanical-label" text-anchor="middle">
            Pedal
          </text>

          <line
            x1="50"
            y1="50"
            x2="100"
            y2="50"
            stroke="#000"
            stroke-width="2"
          />
          <circle cx="100" cy="50" r="10" fill="#aaa" />
          <text x="100" y="30" class="mechanical-label" text-anchor="middle">
            Throttle
          </text>

          <line
            x1="100"
            y1="50"
            x2="150"
            y2="100"
            stroke="#000"
            stroke-width="2"
          />
          <rect x="140" y="100" width="20" height="20" fill="#ccc" />
          <text x="150" y="135" class="mechanical-label" text-anchor="middle">
            Engine
          </text>

          <circle id="ecuLight" cx="100" cy="150" r="10" fill="gray" />
          <text x="100" y="170" class="mechanical-label" text-anchor="middle">
            ECU
          </text>
        </svg>
      </div>
    </div>

    <script>
      let speed = 0;
      let cruiseEnabled = false;
      let cruiseSpeed = 0;
      let roadPosition = 0;
      let lastTime = 0;

      const road = document.getElementById("road");

      // Clear existing lane markers
      road.innerHTML = "";

      // Create two sets of lane markers that we'll animate in parallel
      const laneSet1 = document.createElement("div");
      laneSet1.className = "lane-set";
      laneSet1.style.position = "absolute";
      laneSet1.style.width = "100%";
      laneSet1.style.height = "100%";
      laneSet1.style.top = "0";

      const laneSet2 = document.createElement("div");
      laneSet2.className = "lane-set";
      laneSet2.style.position = "absolute";
      laneSet2.style.width = "100%";
      laneSet2.style.height = "100%";
      laneSet2.style.top = "-100%";

      road.appendChild(laneSet1);
      road.appendChild(laneSet2);

      // Create realistic dashed lane markers with proper spacing
      // Highway lane markers are typically about 10 feet long with 30 feet gaps
      // We'll simulate this with a visual ratio
      const lineCount = 15; // Fewer lines with bigger gaps
      const gapRatio = 3; // Gap is 3 times the length of the line

      for (let i = 0; i < lineCount; i++) {
        const linePosition =
          i * (1 + gapRatio) * (100 / (lineCount * (1 + gapRatio)));

        const line1 = document.createElement("div");
        line1.className = "lane-line";
        line1.style.top = `${linePosition}%`;
        laneSet1.appendChild(line1);

        const line2 = document.createElement("div");
        line2.className = "lane-line";
        line2.style.top = `${linePosition}%`;
        laneSet2.appendChild(line2);
      }

      function updateUI() {
        document.getElementById("speed").innerText = speed.toFixed(1);
        document.getElementById("cruiseStatus").innerText = cruiseEnabled
          ? `ON (${cruiseSpeed} km/h)`
          : "OFF";
        document.getElementById("mechanicsLog").innerText = cruiseEnabled
          ? `ECU is controlling the throttle to maintain ${cruiseSpeed} km/h.`
          : "Driver manually pressing the pedal to change speed.";
        document
          .getElementById("ecuLight")
          .setAttribute("fill", cruiseEnabled ? "green" : "gray");
      }

      function accelerate() {
        if (!cruiseEnabled) speed += 5;
      }

      function decelerate() {
        if (!cruiseEnabled && speed > 0) speed -= 5;
      }

      function toggleCruise() {
        if (!cruiseEnabled && speed > 0) {
          cruiseEnabled = true;
          cruiseSpeed = speed.toFixed(1);
        } else {
          cruiseEnabled = false;
        }
        updateUI();
      }

      function simulateDrive(currentTime) {
        if (!lastTime) lastTime = currentTime;
        const deltaTime = (currentTime - lastTime) / 1000;
        lastTime = currentTime;

        if (cruiseEnabled) {
          speed += (cruiseSpeed - speed) * 0.05;
        }

        if (speed > 0) {
          // Update road position with positive value (0-100%)
          roadPosition += speed * deltaTime * 0.5;

          // When position exceeds 100%, reset to continue the loop
          if (roadPosition >= 100) {
            roadPosition = 0;
          }

          // Apply transforms to both lane sets
          laneSet1.style.transform = `translateY(${roadPosition}%)`;
          laneSet2.style.transform = `translateY(${roadPosition}%)`;
        }

        updateUI();
        requestAnimationFrame(simulateDrive);
      }

      // Start the animation loop
      requestAnimationFrame(simulateDrive);
    </script>
  </body>
</html>
